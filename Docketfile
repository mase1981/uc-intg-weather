FROM python:3.11-slim

WORKDIR /app

# Install system dependencies if needed
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements and install Python dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the integration files
COPY uc_intg_weather/ ./uc_intg_weather/
COPY driver.json .
COPY README.md .

# Create config directory
RUN mkdir -p /app/config

# Set environment variables
ENV UC_CONFIG_HOME=/app/config
ENV UC_INTEGRATION_HTTP_PORT=9094
ENV UC_INTEGRATION_INTERFACE=0.0.0.0
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# Expose the port
EXPOSE 9094

# Run the integration
CMD ["python", "-m", "uc_intg_weather.driver"]